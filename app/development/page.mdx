# Development Guide

This guide covers the development workflow, best practices, and tools for building with the Next.js Enterprise Starter Kit.

## Development Workflow

### Code Quality Standards

The project enforces strict code quality standards through automated tooling and configuration.

#### TypeScript Configuration

```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

#### ESLint Configuration

```json
// .eslintrc.json
{
  "extends": [
    "next/core-web-vitals",
    "@typescript-eslint/recommended",
    "prettier"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/prefer-const": "error",
    "prefer-const": "error",
    "no-var": "error",
    "no-console": "warn"
  },
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2021,
    "sourceType": "module"
  }
}
```

#### Prettier Configuration

```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

### Development Commands

```bash
# Development server with hot reload
npm run dev

# Type checking
npm run type-check

# Linting
npm run lint
npm run lint:fix

# Code formatting
npm run format
npm run format:check

# Testing
npm run test
npm run test:watch
npm run test:coverage

# Build
npm run build
npm run build:analyze
```

## Component Development

### Component Structure

Follow this structure for consistent component organization:

```
components/
├── ui/                 # Base UI components (shadcn/ui)
├── forms/             # Form-specific components
├── layout/            # Layout components
├── dashboard/         # Dashboard-specific components
└── common/            # Shared components
```

### Component Template

```typescript
// components/example/ExampleComponent.tsx
import React from 'react';
import { cn } from '@/lib/utils';

interface ExampleComponentProps {
  title: string;
  description?: string;
  variant?: 'default' | 'primary' | 'secondary';
  size?: 'sm' | 'md' | 'lg';
  className?: string;
  children?: React.ReactNode;
}

const ExampleComponent = React.forwardRef<
  HTMLDivElement,
  ExampleComponentProps
>(({ 
  title, 
  description, 
  variant = 'default', 
  size = 'md', 
  className, 
  children,
  ...props 
}, ref) => {
  return (
    <div
      ref={ref}
      className={cn(
        'example-component',
        `example-component--${variant}`,
        `example-component--${size}`,
        className
      )}
      {...props}
    >
      <h3 className="example-component__title">{title}</h3>
      {description && (
        <p className="example-component__description">{description}</p>
      )}
      {children}
    </div>
  );
});

ExampleComponent.displayName = 'ExampleComponent';

export { ExampleComponent };
export type { ExampleComponentProps };
```

### Component Documentation

```typescript
// components/example/ExampleComponent.stories.tsx
import type { Meta, StoryObj } from '@storybook/react';
import { ExampleComponent } from './ExampleComponent';

const meta: Meta<typeof ExampleComponent> = {
  title: 'Components/ExampleComponent',
  component: ExampleComponent,
  parameters: {
    layout: 'centered',
  },
  tags: ['autodocs'],
  argTypes: {
    variant: {
      control: { type: 'select' },
      options: ['default', 'primary', 'secondary'],
    },
    size: {
      control: { type: 'select' },
      options: ['sm', 'md', 'lg'],
    },
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    title: 'Example Component',
    description: 'This is an example component',
  },
};

export const Primary: Story = {
  args: {
    title: 'Primary Variant',
    variant: 'primary',
  },
};

export const WithChildren: Story = {
  args: {
    title: 'With Children',
    children: <p>This is child content</p>,
  },
};
```

## Testing Strategy

### Unit Testing

Test individual components and functions:

```typescript
// __tests__/components/ExampleComponent.test.tsx
import { render, screen } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { ExampleComponent } from '@/components/example/ExampleComponent';

describe('ExampleComponent', () => {
  it('renders with title', () => {
    render(<ExampleComponent title="Test Title" />);
    expect(screen.getByText('Test Title')).toBeInTheDocument();
  });

  it('renders description when provided', () => {
    render(
      <ExampleComponent 
        title="Test Title" 
        description="Test Description" 
      />
    );
    expect(screen.getByText('Test Description')).toBeInTheDocument();
  });

  it('applies correct variant class', () => {
    const { container } = render(
      <ExampleComponent title="Test" variant="primary" />
    );
    expect(container.firstChild).toHaveClass('example-component--primary');
  });

  it('handles click events', async () => {
    const handleClick = jest.fn();
    render(
      <ExampleComponent 
        title="Test" 
        onClick={handleClick} 
      />
    );
    
    await userEvent.click(screen.getByText('Test'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });
});
```

### Integration Testing

Test component interactions and API integration:

```typescript
// __tests__/integration/UserForm.test.tsx
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { UserForm } from '@/components/forms/UserForm';
import { userAPI } from '@/lib/api';

// Mock API
jest.mock('@/lib/api');
const mockUserAPI = userAPI as jest.Mocked<typeof userAPI>;

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: { retry: false },
      mutations: { retry: false },
    },
  });
  
  return ({ children }: { children: React.ReactNode }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
};

describe('UserForm Integration', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('submits form with valid data', async () => {
    const user = userEvent.setup();
    mockUserAPI.create.mockResolvedValue({ id: 1, name: 'John Doe' });

    render(<UserForm />, { wrapper: createWrapper() });

    await user.type(screen.getByLabelText(/name/i), 'John Doe');
    await user.type(screen.getByLabelText(/email/i), 'john@example.com');
    await user.click(screen.getByRole('button', { name: /submit/i }));

    await waitFor(() => {
      expect(mockUserAPI.create).toHaveBeenCalledWith({
        name: 'John Doe',
        email: 'john@example.com',
      });
    });
  });

  it('displays validation errors', async () => {
    const user = userEvent.setup();
    render(<UserForm />, { wrapper: createWrapper() });

    await user.click(screen.getByRole('button', { name: /submit/i }));

    expect(screen.getByText(/name is required/i)).toBeInTheDocument();
    expect(screen.getByText(/email is required/i)).toBeInTheDocument();
  });
});
```

### E2E Testing

Test critical user flows:

```typescript
// __tests__/e2e/auth.test.ts
import { test, expect } from '@playwright/test';

test.describe('Authentication Flow', () => {
  test('user can login successfully', async ({ page }) => {
    await page.goto('/auth/login');

    await page.fill('[data-testid="email"]', 'user@example.com');
    await page.fill('[data-testid="password"]', 'password123');
    await page.click('[data-testid="login-button"]');

    await expect(page).toHaveURL('/dashboard');
    await expect(page.locator('[data-testid="user-menu"]')).toBeVisible();
  });

  test('user sees error with invalid credentials', async ({ page }) => {
    await page.goto('/auth/login');

    await page.fill('[data-testid="email"]', 'invalid@example.com');
    await page.fill('[data-testid="password"]', 'wrongpassword');
    await page.click('[data-testid="login-button"]');

    await expect(page.locator('[data-testid="error-message"]')).toBeVisible();
    await expect(page.locator('[data-testid="error-message"]')).toContainText(
      'Invalid credentials'
    );
  });
});
```

## Performance Optimization

### Bundle Analysis

Regularly analyze your bundle size:

```bash
# Build and analyze bundle
npm run build
npm run analyze

# Check for duplicate dependencies
npx duplicate-package-checker

# Analyze specific chunks
npx webpack-bundle-analyzer .next/static/chunks/*.js
```

### Code Splitting

Implement strategic code splitting:

```typescript
// Dynamic imports for heavy components
const DashboardCharts = lazy(() => 
  import('./components/DashboardCharts').then(module => ({
    default: module.DashboardCharts
  }))
);

// Route-based splitting
const Dashboard = lazy(() => import('./pages/Dashboard'));

// Conditional loading
const AdminPanel = lazy(() => 
  import('./components/AdminPanel').then(module => {
    // Only load if user is admin
    if (user?.role !== 'admin') {
      return { default: () => <AccessDenied /> };
    }
    return { default: module.AdminPanel };
  })
);

// Usage with Suspense
<Suspense fallback={<ComponentSkeleton />}>
  <DashboardCharts />
</Suspense>
```

### Image Optimization

```typescript
// Next.js Image component with optimization
import Image from 'next/image';

const OptimizedImage = ({ src, alt, ...props }) => {
  return (
    <Image
      src={src}
      alt={alt}
      width={800}
      height={600}
      placeholder="blur"
      blurDataURL="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ..."
      sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
      {...props}
    />
  );
};
```

### Performance Monitoring

```typescript
// Performance monitoring with Web Vitals
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

const sendToAnalytics = (metric) => {
  // Send to your analytics service
  analytics.track('Web Vital', {
    name: metric.name,
    value: metric.value,
    id: metric.id,
  });
};

// Measure Core Web Vitals
getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getFCP(sendToAnalytics);
getLCP(sendToAnalytics);
getTTFB(sendToAnalytics);
```

## API Development

### API Route Structure

```typescript
// app/api/users/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { z } from 'zod';
import { auth } from '@/lib/auth';
import { userService } from '@/lib/services/user';

const createUserSchema = z.object({
  name: z.string().min(2),
  email: z.string().email(),
  role: z.enum(['admin', 'user']),
});

export async function GET(request: NextRequest) {
  try {
    const session = await auth(request);
    if (!session) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const users = await userService.getAll();
    return NextResponse.json(users);
  } catch (error) {
    return NextResponse.json(
      { error: 'Internal Server Error' },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const session = await auth(request);
    if (!session || session.user.role !== 'admin') {
      return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
    }

    const body = await request.json();
    const validatedData = createUserSchema.parse(body);
    
    const user = await userService.create(validatedData);
    return NextResponse.json(user, { status: 201 });
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json(
        { error: 'Validation Error', details: error.errors },
        { status: 400 }
      );
    }
    
    return NextResponse.json(
      { error: 'Internal Server Error' },
      { status: 500 }
    );
  }
}
```

### Error Handling

```typescript
// lib/errors.ts
export class AppError extends Error {
  constructor(
    message: string,
    public statusCode: number = 500,
    public code?: string
  ) {
    super(message);
    this.name = 'AppError';
  }
}

export class ValidationError extends AppError {
  constructor(message: string, public errors: any[]) {
    super(message, 400, 'VALIDATION_ERROR');
  }
}

export class NotFoundError extends AppError {
  constructor(resource: string) {
    super(`${resource} not found`, 404, 'NOT_FOUND');
  }
}

// Global error handler
export const handleApiError = (error: unknown) => {
  if (error instanceof AppError) {
    return NextResponse.json(
      { error: error.message, code: error.code },
      { status: error.statusCode }
    );
  }

  console.error('Unhandled API error:', error);
  return NextResponse.json(
    { error: 'Internal Server Error' },
    { status: 500 }
  );
};
```

## Debugging

### Development Tools

```typescript
// lib/logger.ts
import pino from 'pino';

const logger = pino({
  level: process.env.NODE_ENV === 'development' ? 'debug' : 'info',
  browser: {
    asObject: true,
  },
  formatters: {
    level: (label) => ({ level: label }),
  },
});

// Usage throughout the application
logger.info('User action', { userId, action: 'login' });
logger.error('API error', { error: error.message, stack: error.stack });
logger.debug('Component rendered', { component: 'UserForm', props });
```

### React Developer Tools

Install and configure React Developer Tools for debugging:

```typescript
// components/DevTools.tsx (development only)
import { lazy, Suspense } from 'react';

const ReactQueryDevtools = lazy(() =>
  import('@tanstack/react-query-devtools').then(module => ({
    default: module.ReactQueryDevtools,
  }))
);

const ReduxDevTools = lazy(() =>
  import('@reduxjs/toolkit/query/react').then(module => ({
    default: module.setupListeners,
  }))
);

export const DevTools = () => {
  if (process.env.NODE_ENV !== 'development') {
    return null;
  }

  return (
    <Suspense fallback={null}>
      <ReactQueryDevtools initialIsOpen={false} />
      <ReduxDevTools />
    </Suspense>
  );
};
```

This development guide provides the foundation for building high-quality applications with the Next.js Enterprise Starter Kit. Follow these practices to maintain code quality, performance, and maintainability throughout your development process.